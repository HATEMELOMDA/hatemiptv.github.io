<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>IPTV Arabia • Overlay List</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
  <style>
    :root{--brand:#10b981}
    html,body{margin:0;height:100%;background:#000;font-family:Tahoma,Arial,sans-serif}
    #video{position:fixed;inset:0;width:100%;height:100%;object-fit:cover}

    /* Toggle */
    #toggle{position:fixed;bottom:1rem;right:1rem;z-index:30;width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.6rem;background:var(--brand);color:#fff;box-shadow:0 6px 16px rgba(0,0,0,.4)}

    /* Overlay list */
    #panel{position:fixed;inset:0;background:#000000aa;backdrop-filter:blur(6px);display:none;z-index:40;flex-direction:column;align-items:center;justify-content:center;padding:1.5rem}
    #panel.show{display:flex}
    #listWrap{width:90%;max-width:480px;background:#1f2937;border-radius:1rem;padding:1rem;max-height:80vh;overflow-y:auto;box-shadow:0 6px 20px rgba(0,0,0,.5)}
    #search{width:100%;margin-bottom:.75rem;border:0;border-radius:.5rem;padding:.6rem .8rem;font-size:1rem}
    ul{list-style:none;margin:0;padding:0}
    .item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:.5rem;cursor:pointer;transition:background .2s;font-size:1.05rem;color:#e5e7eb}
    .item:hover{background:#374151}
    .item.active{background:var(--brand);color:#fff}
    .item img{width:80px;height:44px;object-fit:cover;border-radius:4px;background:#e5e7eb}
    .item span{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    #overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);color:#fff;display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:1.5rem;z-index:60}
    #overlay button{margin-top:1rem;background:var(--brand);padding:.6rem 1.5rem;border:none;border-radius:.4rem;color:#fff;font-size:1rem}
  </style>
</head>
<body>
  <video id="video" autoplay muted controls></video>
  <button id="toggle" title="القنوات">☰</button>

  <div id="panel" role="dialog" aria-label="قائمة القنوات">
    <div id="listWrap" onclick="event.stopPropagation()">
      <input id="search" type="text" placeholder="بحث عن قناة…">
      <ul id="list"></ul>
    </div>
  </div>

  <div id="overlay"></div>

<script>
(function(){
  var video=document.getElementById('video');
  var toggle=document.getElementById('toggle');
  var panel=document.getElementById('panel');
  var list=document.getElementById('list');
  var search=document.getElementById('search');
  var overlay=document.getElementById('overlay');

  var channels=[],current=0;

  function ajax(u,cb){var x=new XMLHttpRequest();x.open('GET',u,true);x.onreadystatechange=function(){if(x.readyState===4)cb(x.status===200?x.responseText:null)};x.send();}
  function attr(l,k){var m=l.match(new RegExp(k+'="([^"]+)"','i'));return m?m[1]:'';}
  function parse(t){var a=[],l=t.split(/\r?\n/);for(var i=0;i<l.length;i++){if(l[i].indexOf('#EXTINF')===0){var n=l[i].split(',').slice(1).join(',').trim();var u=l[i+1]&&l[i+1].trim();if(u&&u.charAt(0)!=='#')a.push({name:n,url:u,logo:attr(l[i],'tvg-logo')});}}return a;}

  function load(){ajax('channels.m3u',function(t){if(t){init(parse(t));}else{ajax('https://iptv-org.github.io/iptv/languages/ara.m3u',function(r){init(parse(r||''));});}});}

  function build(){list.innerHTML='';for(var i=0;i<channels.length;i++){var li=document.createElement('li');li.className='item';li.innerHTML='<img src="'+(channels[i].logo||'https://placehold.co/80x44?text=TV')+'"><span>'+channels[i].name+'</span>';(function(idx){li.onclick=function(){play(idx);panel.classList.remove('show');};})(i);list.appendChild(li);}highlight();}
  function highlight(){for(var i=0;i<list.children.length;i++){list.children[i].classList.toggle('active',i===current);} }

  function show(msg){overlay.innerHTML=msg+'<br><button onclick="overlay.style.display=\'none\'">إغلاق</button>';overlay.style.display='flex';}

  function play(idx){current=idx;highlight();var ch=channels[idx];if(location.protocol==='https:'&&ch.url.indexOf('http://')===0){return show('القناة عبر HTTP والصفحة HTTPS.\nافتح بالرابط HTTP أو استضف داخلياً.');}
    if(Hls.isSupported()){if(window.hls)window.hls.destroy();window.hls=new Hls();window.hls.loadSource(ch.url);window.hls.attachMedia(video);window.hls.on(Hls.Events.MANIFEST_PARSED,function(){video.muted=false;video.play();});window.hls.on(Hls.Events.ERROR,function(){show('تعذّر تشغيل القناة');});}
    else if(video.canPlayType('application/vnd.apple.mpegurl')){video.src=ch.url;video.muted=false;video.load();video.play();}
    else show('HLS غير مدعوم');}

  search.oninput=function(){var q=search.value.toLowerCase();for(var i=0;i<channels.length;i++){var item=list.children[i];var m=channels[i].name.toLowerCase().indexOf(q)!==-1;item.style.display=m?'':'none';}};

  toggle.onclick=function(){panel.classList.toggle('show');search.value='';search.oninput();search.focus();};
  panel.onclick=function(){panel.classList.remove('show');};

  document.addEventListener('keydown',function(e){if(!panel.classList.contains('show')&&(e.keyCode===13||e.keyCode===32)){toggle.click();e.preventDefault();}});

  function init(l){channels=l;if(!channels.length)return show('لا توجد قنوات');build();play(0);}load();
})();
</script>
</body>
</html>
