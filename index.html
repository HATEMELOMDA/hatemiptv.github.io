<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HatemÂ IPTV â€“ Ù‚Ù†ÙˆØ§Øª Ø¹Ø±Ø¨ÙŠÙ‘Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
  <style>
    body{font-family:sans-serif}
    .channel-active{background-color:#2563eb;color:#fff}
    #overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.7);color:#fff;text-align:center;z-index:50;padding:2rem}
  </style>
</head>
<body class="min-h-screen flex bg-gray-100">
  <!--â”€â”€â”€â”€â”€â”€â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€-->
  <aside class="w-80 bg-white shadow-xl overflow-y-auto">
    <div class="p-4 space-y-3">
      <input id="search" type="text" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©â€¦" class="w-full rounded-lg border-gray-300">
      <label class="flex items-center text-xs gap-2 select-none cursor-pointer">
        <input id="toggleRadio" type="checkbox" class="h-4 w-4 border-gray-300 rounded checked:bg-blue-600" checked>
        Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ (ØµÙˆØª ÙÙ‚Ø·)
      </label>
      <details class="text-xs text-gray-600 leading-normal border-t pt-2">
        <summary class="cursor-pointer">Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© "ØµÙˆØª Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©"</summary>
        <div class="mt-1 space-y-1">
          <p>âœ¦ Ù…Ø¹Ø¸Ù… Ø¨Ø«Ù‘ÙŠØ§Øª <strong>.m3u8</strong> Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‘Ø© ØªÙØ±Ø³ÙÙ„ Ø¹Ø¨Ø± <code>http://</code> ÙÙ‚Ø·ØŒ Ø¨ÙŠÙ†Ù…Ø§ GitHub Pages ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ <code>https://</code>.</p>
          <p>âœ¦ Ù…ØªØµÙÙ‘Ø­Ø§Øª Ø§Ù„ÙŠÙˆÙ… ØªØ­Ø¬Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ø§Ù„Ø¢Ù…Ù† ÙˆØªØ³Ù…Ø­ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø¨Ù…Ø±ÙˆØ± Ø§Ù„ØµÙˆØª ÙÙ‚Ø· â‡’ ØªØ³Ù…Ø¹ ÙˆÙ„Ø§ ØªØ±Ù‰.</p>
          <p>âœ¦ Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¹Ø¨Ø± <kbd>http://</kbd> Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† <kbd>https://</kbd> (Ø§Ø¶ØºØ· â€â†˜ Ø£Ùˆ Ø§Ø³ØªØ¹Ù…Ù„ Ø¯ÙˆÙ…ÙŠÙ† Ù…Ø®ØµÙ‘Øµ Ø¨Ù„Ø§ SSL) Ø£Ùˆ Ø§Ø³ØªØ¶Ù Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… Ø¯Ø§Ø®Ù„ÙŠ â€HTTP.</p>
        </div>
      </details>
    </div>
    <ul id="channelList" class="space-y-0.5"></ul>
  </aside>

  <!--â”€â”€â”€â”€â”€â”€â”€â”€ Player â”€â”€â”€â”€â”€â”€â”€â”€â”€-->
  <main class="flex-1 flex flex-col items-center justify-center p-4 relative">
    <div id="overlay"></div>
    <video id="video" class="w-full max-w-6xl aspect-video rounded-2xl shadow-lg bg-black" controls playsinline></video>
    <h2 id="nowPlaying" class="mt-4 text-xl font-semibold"></h2>
  </main>

  <!--â”€â”€â”€â”€â”€â”€â”€â”€ Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€-->
  <script>
    // ========= 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª =========
    async function getChannels(){
      // channels.json â†’ channels.m3u â†’ ara.m3u (iptvâ€‘org)
      const order = [
        {url:'channels.json', json:true},
        {url:'channels.m3u',  json:false},
        {url:'https://iptv-org.github.io/iptv/languages/ara.m3u', json:false}
      ];
      for(const src of order){
        try{
          const res = await fetch(src.url);
          if(!res.ok) continue;
          return src.json? await res.json() : parseM3U(await res.text());
        }catch{}
      }
      throw new Error('ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª');
    }

    // ========= 2. Parser =========
    function attr(line,key){
      const m = line.match(new RegExp(`${key}="([^"]+)"`,`i`));
      return m?m[1]:'';
    }
    function parseM3U(txt){
      const lines = txt.split(/\r?\n/);
      const list=[];
      for(let i=0;i<lines.length;i++){
        if(lines[i].startsWith('#EXTINF')){
          const meta = lines[i];
          const url  = lines[i+1]?.trim();
          if(!url||url.startsWith('#')) continue;
          const name = meta.split(',').slice(1).join(',').trim();
          const grp  = attr(meta,'group-title').toLowerCase();
          const typ  = attr(meta,'tvg-type').toLowerCase();
          const type = grp.includes('radio')||typ==='audio'? 'radio':'tv';
          list.push({name,url,type});
        }
      }
      return list;
    }

    // ========= 3. Elements =========
    const $list   = document.getElementById('channelList');
    const $video  = document.getElementById('video');
    const $title  = document.getElementById('nowPlaying');
    const $srch   = document.getElementById('search');
    const $radChk = document.getElementById('toggleRadio');
    const $overlay= document.getElementById('overlay');

    let channels=[], filtered=[];

    // ========= 4. UI =========
    function draw(){
      $list.innerHTML='';
      filtered.forEach((c,i)=>{
        c.idx=i;
        const li=document.createElement('li');
        li.id='c'+i;
        li.className='cursor-pointer px-4 py-2 hover:bg-gray-200 truncate flex items-center gap-2';
        li.innerHTML=(c.type==='radio'?'ğŸ§':'ğŸ“º')+' '+(c.name||'Channel '+(i+1));
        li.onclick=()=>play(c);
        $list.appendChild(li);
      });
    }
    function filter(){
      const q=$srch.value.toLowerCase();
      filtered = channels.filter(c=>{
        if(!$radChk.checked && c.type==='radio') return false;
        return c.name.toLowerCase().includes(q);
      });
      draw();
    }

    // ========= 5. Player =========
    function showOverlay(msg){
      $overlay.textContent=msg; $overlay.style.display='flex';
    }
    function hideOverlay(){ $overlay.style.display='none'; }

    function play(ch){
      document.querySelectorAll('#channelList li').forEach(li=>li.classList.remove('channel-active'));
      const li=document.getElementById('c'+ch.idx); if(li) li.classList.add('channel-active');
      $title.textContent=ch.name;

      // Mixedâ€‘content detector
      if(location.protocol==='https:' && ch.url.startsWith('http://')){
        showOverlay('ğŸ’¡ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ù†Ø§Ø© ØªÙØ±Ø³Ù„ Ø¹Ø¨Ø± HTTP ÙÙ‚Ø·\nØ§Ù„Ù…ØªØµÙÙ‘Ø­ ÙŠÙ…Ù†Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ø§Ù„Ø¢Ù…Ù† Ø¹Ù„Ù‰ HTTPS.\nØ§ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù€Ù€Â HTTP Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø®Ø§Ø¯Ù… Ø¯Ø§Ø®Ù„ÙŠ.');
        return;
      }else hideOverlay();

      if(Hls.isSupported()){
        if(window.hls) window.hls.destroy();
        window.hls=new Hls({autoStartLoad:true});
        window.hls.loadSource(ch.url);
        window.hls.attachMedia($video);
        window.hls.on(Hls.Events.ERROR,(ev,d)=>{ if(d.fatal) showOverlay('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©'); });
      }else if($video.canPlayType('application/vnd.apple.mpegurl')){
        $video.src=ch.url;
      }else{
        showOverlay('Ø§Ù„Ù…ØªØµÙÙ‘Ø­ Ù„Ø§ ÙŠØ¯Ø¹Ù… HLS');
      }
      $video.play();
    }

    // ========= 6. Init =========
    (async()=>{
      try{
        channels = await getChannels();
        filter();
        const first = channels.find(c=>c.type==='tv')||channels[0];
        if(first) play(first);
      }catch(e){ showOverlay(e.message); }
    })();

    // ========= 7. Events =========
    $srch.oninput = filter;
    $radChk.onchange = filter;
  </script>
</body>
</html>
