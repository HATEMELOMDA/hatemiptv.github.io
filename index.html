<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hatem IPTV â€“ Ù‚Ù†ÙˆØ§Øª Ø¹Ø±Ø¨ÙŠÙ‘Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
  <style>
    body{font-family:sans-serif}
    .channel-active{background-color:#2563eb;color:#fff}
  </style>
</head>
<body class="min-h-screen flex bg-gray-100">
  <!--â”€â”€â”€â”€â”€â”€â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€-->
  <aside class="w-80 bg-white shadow-xl overflow-y-auto">
    <div class="p-4 space-y-3">
      <input id="search" type="text" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©â€¦" class="w-full rounded-lg border-gray-300">
      <label class="flex items-center text-xs gap-2 select-none cursor-pointer">
        <input id="toggleRadio" type="checkbox" class="h-4 w-4 border-gray-300 rounded checked:bg-blue-600" checked>
        Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ (ØµÙˆØª ÙÙ‚Ø·)
      </label>
      <details class="text-xs text-gray-600 leading-normal border-t pt-2">
        <summary class="cursor-pointer">ÙƒÙŠÙÙŠØ© Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¦Ù…Ø© Ø£Ø®Ø±Ù‰ØŸ</summary>
        <p class="mt-1">
          âœ¦ Ø¶ÙØ¹ <code>channels.m3u</code> Ø£Ùˆ <code>channels.json</code> Ø¨Ø¬ÙˆØ§Ø± Ø§Ù„ØµÙØ­Ø© Ø«Ù… Ø§Ø¶ØºØ· <kbd>Ctrlâ€¯+â€¯R</kbd>.<br>
          âœ¦ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù†Ø­Ù…Ù„ <em>ara.m3u</em> Ù…Ù† <a class="text-blue-600 underline" href="https://iptv-org.github.io/iptv/">iptvâ€‘org</a>ØŒ ÙˆØ§Ù„ØªÙŠ ØªØ­ÙˆÙŠ Ù…Ø¦Ø§Øª Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‘Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø©.
        </p>
      </details>
    </div>
    <ul id="channelList" class="space-y-0.5"></ul>
  </aside>

  <!--â”€â”€â”€â”€â”€â”€â”€â”€ Player â”€â”€â”€â”€â”€â”€â”€â”€â”€-->
  <main class="flex-1 flex flex-col items-center justify-center p-4">
    <video id="video" class="w-full max-w-6xl aspect-video rounded-2xl shadow-lg bg-black" controls playsinline></video>
    <h2 id="nowPlaying" class="mt-4 text-xl font-semibold"></h2>
  </main>

  <!--â”€â”€â”€â”€â”€â”€â”€â”€ Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€-->
  <script>
    /**
     * Loading priority:
     * 1) channels.json (local)
     * 2) channels.m3u  (local)
     * 3) ara.m3u      (remote from iptvâ€‘org)
     */
    async function getChannels(){
      // JSON (local)
      try{
        const res = await fetch('channels.json');
        if(res.ok) return await res.json();
      }catch{}
      // M3U (local)
      try{
        const res = await fetch('channels.m3u');
        if(res.ok) return parseM3U(await res.text());
      }catch{}
      // Remote arabic playlist
      const res = await fetch('https://iptv-org.github.io/iptv/languages/ara.m3u');
      if(!res.ok) throw new Error('Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø©');
      return parseM3U(await res.text());
    }

    // --- Helpers ---
    function getAttr(str,attr){
      const match = str.match(new RegExp(attr+'="([^"]+)"','i'));
      return match?match[1]:'';
    }
    // Convert M3U â†’ Array<{name,url,type}>
    function parseM3U(txt){
      const lines = txt.split(/\r?\n/);
      const list  = [];
      for(let i=0;i<lines.length;i++){
        if(lines[i].startsWith('#EXTINF')){
          const info = lines[i];
          const name = info.split(',').slice(1).join(',').trim();
          const url  = lines[i+1]?.trim();
          if(!url || url.startsWith('#')) continue;
          // Determine type (Radio vs TV) from group-title or tvg-type
          const group   = getAttr(info,'group-title').toLowerCase();
          const tvgType = getAttr(info,'tvg-type').toLowerCase();
          const type    = group.includes('radio')||tvgType==='audio'? 'radio':'tv';
          list.push({name,url,type});
        }
      }
      return list;
    }

    // --- DOM & State ---
    const channelListEl = document.getElementById('channelList');
    const videoEl       = document.getElementById('video');
    const nowPlaying    = document.getElementById('nowPlaying');
    const searchBox     = document.getElementById('search');
    const toggleRadio   = document.getElementById('toggleRadio');

    let channels = [];
    let filtered = [];

    function render(){
      channelListEl.innerHTML='';
      filtered.forEach((ch,i)=>{
        ch.idx = i;
        const li = document.createElement('li');
        li.id = 'channel-'+i;
        li.className = 'cursor-pointer px-4 py-2 hover:bg-gray-200 truncate flex items-center gap-2';
        li.innerHTML = ch.type==='radio'? 'ğŸ§':'ğŸ“º';
        li.innerHTML += ' '+(ch.name||'Channel '+(i+1));
        li.addEventListener('click',()=>playChannel(ch));
        channelListEl.appendChild(li);
      });
    }

    function applyFilters(){
      const q = searchBox.value.trim().toLowerCase();
      filtered = channels.filter(c=>{
        if(!toggleRadio.checked && c.type==='radio') return false; // hide radio
        return c.name.toLowerCase().includes(q);
      });
      render();
    }

    function playChannel(ch){
      document.querySelectorAll('#channelList li').forEach(li=>li.classList.remove('channel-active'));
      const li = document.getElementById('channel-'+ch.idx);
      if(li) li.classList.add('channel-active');
      nowPlaying.textContent = ch.name;

      if(Hls.isSupported()){
        if(window.hls) window.hls.destroy();
        window.hls = new Hls({autoStartLoad:true});
        window.hls.loadSource(ch.url);
        window.hls.attachMedia(videoEl);
        window.hls.on(Hls.Events.ERROR,(ev,data)=>{
          if(data.fatal){
            alert('ØªØ¹Ø°Ù‘Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©. Ø¬Ø±Ù‘Ø¨ Ù‚Ù†Ø§Ø© Ø£Ø®Ø±Ù‰.');
          }
        });
      }else if(videoEl.canPlayType('application/vnd.apple.mpegurl')){
        videoEl.src = ch.url;
      }else{
        alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… â€HLS');
      }
      videoEl.play();
    }

    // Init
    (async()=>{
      try{
        channels = await getChannels();
        applyFilters();
        // Autoâ€‘play first nonâ€‘radio channel if Ù…ÙˆØ¬ÙˆØ¯
        const firstTV = channels.find(c=>c.type==='tv')||channels[0];
        if(firstTV) playChannel(firstTV);
      }catch(err){
        alert(err.message);
      }
    })();

    // events
    searchBox.addEventListener('input',applyFilters);
    toggleRadio.addEventListener('change',applyFilters);
  </script>
</body>
</html>
